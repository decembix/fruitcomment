<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜í™”</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #333;
            color: white;
            padding: 10px;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-links {
            display: flex;
            gap: 20px;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 10px;
        }
        .search-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .search-box input {
            padding: 5px;
            width: 200px;
        }
        .search-box button {
            padding: 5px;
        }
        .container {
            padding: 140px 20px 20px; /* Header ë†’ì´ì™€ ë¹„ë””ì˜¤ ë†’ì´ë§Œí¼ ì—¬ë°±ì„ ë‘¡ë‹ˆë‹¤ */
        }
        .movie-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .movie-item {
            width: 200px;
            text-align: center;
        }
        .movie-item img {
            width: 100%;
            height: auto;
        }
        #results {
            margin-top: 20px;
        }
        .login-signup {
            margin-left: auto;
        }

        /* ì˜í™” í¬ìŠ¤í„° ì»¨í…Œì´ë„ˆ */
        .poster-container {
            width: 100%;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            margin-bottom: 20px;
            overflow: hidden; /* ì˜ë¦° ë¶€ë¶„ì„ ìˆ¨ê¹ë‹ˆë‹¤ */
        }

        .poster-container img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ ìë¥´ê¸° */
        }
        

        /* ëª¨ë‹¬ ì°½ ìŠ¤íƒ€ì¼ */
        #search-modal {
            display: none; /* ì²˜ìŒì—ëŠ” ë³´ì´ì§€ ì•Šë„ë¡ ì„¤ì • */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            text-align: center;
            max-height: 80vh; /* í™”ë©´ì˜ 80%ê¹Œì§€ ë†’ì´ë¥¼ ì œí•œ */
            overflow-y: auto; /* ë‚´ìš©ì´ ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
        }

        #results {
            max-height: 70vh; /* ê²°ê³¼ ì˜ì—­ì˜ ìµœëŒ€ ë†’ì´ë¥¼ ì œí•œ */
            overflow-y: auto; /* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì • */
        }
    </style>
    <script>
        const apiKey = 'e5abc725f37f23d195a7177e0f160729'; // ì—¬ê¸°ì— API í‚¤ë¥¼ ë„£ìœ¼ì„¸ìš”

        // ì¸ê¸° ì˜í™” ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        function fetchPopularMovies() {
            fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${apiKey}&language=ko-KR&page=1`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ì¸ê¸° ì˜í™”ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                    return response.json();
                })
                .then(data => {
                    const movieList = document.getElementById('movie-list');
                    movieList.innerHTML = '';
                    if (data.results) {
                        // ì¸ê¸° ì˜í™” 5ê°œë§Œ ë¶ˆëŸ¬ì˜¤ê¸°
                        const movies = data.results.slice(0, 6);
                        movies.forEach(movie => {
                            const movieElement = document.createElement('div');
                            movieElement.classList.add('movie-item');
                            movieElement.innerHTML = `
                                <img src="https://image.tmdb.org/t/p/w200${movie.poster_path}" alt="${movie.title}">
                                <h3>${movie.title}</h3>
                                <p>${movie.release_date}</p>
                            `;
                            movieList.appendChild(movieElement);
                        });
                        showPoster(movies, 0); // ì²« ë²ˆì§¸ ì˜í™” í¬ìŠ¤í„° í‘œì‹œ
                    } else {
                        movieList.innerHTML = '<p>ì˜í™”ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
                    }
                })
                .catch(error => {
                    console.error(error);
                    document.getElementById('movie-list').innerHTML = `<p>${error.message}</p>`;
                });
        }

        // í¬ìŠ¤í„° í‘œì‹œí•˜ê¸°
        function showPoster(movies, index) {
            const posterContainer = document.querySelector('.poster-container');
            posterContainer.innerHTML = ''; // ì´ì „ í¬ìŠ¤í„° ì‚­ì œ

            const movie = movies[index];
            const posterElement = document.createElement('img');
            posterElement.src = `https://image.tmdb.org/t/p/w500${movie.poster_path}`;
            posterElement.alt = movie.title;
            posterContainer.appendChild(posterElement);

            // ì¼ì • ì‹œê°„ í›„ ë‹¤ìŒ ì˜í™” í¬ìŠ¤í„°ë¡œ ë³€ê²½
            setTimeout(() => {
                const nextIndex = (index + 1) % movies.length;
                showPoster(movies, nextIndex);
            }, 5000); // 5ì´ˆë§ˆë‹¤ í¬ìŠ¤í„° ë³€ê²½
        }

        // ì˜í™” ê²€ìƒ‰í•˜ê¸°
        let movieData = null;
        let tvData = null;

        // ì˜í™” ë° TV ë“œë¼ë§ˆ ê²€ìƒ‰í•˜ê¸°
        function searchMoviesAndTVShows() {
            const query = document.getElementById("search-input").value;
            if (!query) {
                alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
                return;
            }

            const movieSearchUrl = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&language=ko-KR&query=${encodeURIComponent(query)}`;
            const tvSearchUrl = `https://api.themoviedb.org/3/search/tv?api_key=${apiKey}&language=ko-KR&query=${encodeURIComponent(query)}`;

            // ë‘ ê°œì˜ API ìš”ì²­ì„ ë™ì‹œì— ì‹¤í–‰
            Promise.all([
                fetch(movieSearchUrl).then(response => response.json()),
                fetch(tvSearchUrl).then(response => response.json())
            ])
            .then(([movieDataResponse, tvDataResponse]) => {
                movieData = movieDataResponse.results; // ì˜í™” ë°ì´í„° ì €ì¥
                tvData = tvDataResponse.results; // ë“œë¼ë§ˆ ë°ì´í„° ì €ì¥

                // ëª¨ë‹¬ ì—´ê¸°
                openModal();

                // ì²˜ìŒ ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ì „ì²´ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤Œ
                showCategory('all');
            })
            .catch(error => {
                console.error(error);
                document.getElementById("results").innerHTML = `<p>ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>`;
            });
        }

        // ì „ì²´/ì˜í™”/ë“œë¼ë§ˆ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê²°ê³¼ ë³´ì—¬ì£¼ê¸°
        function showCategory(category) {
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = ""; // ê¸°ì¡´ ê²€ìƒ‰ ê²°ê³¼ ì´ˆê¸°í™”

            let results = [];

            if (category === 'all' || category === 'movie') {
                if (movieData.length > 0) {
                    results.push(`<h2>ğŸ¬ ì˜í™”</h2>`);
                    movieData.forEach(movie => {
                        results.push(`
                            <div>
                                <h3>${movie.title} (${movie.release_date ? movie.release_date.substring(0, 4) : "ë¯¸ì •"})</h3>
                                <img src="https://image.tmdb.org/t/p/w200${movie.poster_path}" alt="${movie.title}">
                                <p>${movie.overview || "ì¤„ê±°ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤."}</p>
                            </div>
                        `);
                    });
                }
            }

            if (category === 'all' || category === 'tv') {
                if (tvData.length > 0) {
                    results.push(`<h2>ğŸ“º TV ë“œë¼ë§ˆ</h2>`);
                    tvData.forEach(show => {
                        results.push(`
                            <div>
                                <h3>${show.name} (${show.first_air_date ? show.first_air_date.substring(0, 4) : "ë¯¸ì •"})</h3>
                                <img src="https://image.tmdb.org/t/p/w200${show.poster_path}" alt="${show.name}">
                                <p>${show.overview || "ì¤„ê±°ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤."}</p>
                            </div>
                        `);
                    });
                }
            }

            if (results.length === 0) {
                resultsDiv.innerHTML = "<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
            } else {
                resultsDiv.innerHTML = results.join(""); // ê²°ê³¼ ì¶œë ¥
            }
        }

        // ëª¨ë‹¬ ì—´ê¸°
        function openModal() {
            document.getElementById("search-modal").style.display = "flex";
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById("search-modal").style.display = "none";
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ê¸° ì˜í™” ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        window.onload = function() {
            fetchPopularMovies();
        };

        
    </script>
</head>
<body>
    <header>
        <div class="nav-links">
            <a href="{% url 'home' %}">HOME</a>
            <a href="{% url 'movie' %}">MOVIE</a>
            <a href="{% url 'drama' %}">DRAMA</a>
            <a href="#">CHALLENGE</a>
            <a href="#">MYPAGE</a>
        </div>

        <div class="search-box">
            <input type="text" id="search-input" placeholder="ì˜í™”/ë“œë¼ë§ˆ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            <button onclick="searchMoviesAndTVShows()">ê²€ìƒ‰</button>
        </div>

        <div class="login-signup">
            <a href="#">ë¡œê·¸ì¸</a> | <a href="#">íšŒì›ê°€ì…</a>
        </div>
    </header>

    <div class="container">
        <h1>ì˜í™” í™”ë©´</h1>

        <!-- ì˜í™” í¬ìŠ¤í„°ë¥¼ í‘œì‹œí•  ì»¨í…Œì´ë„ˆ -->
        <div class="poster-container">
            <!-- í¬ìŠ¤í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>

        <h2>ì¸ê¸° ì˜í™” ëª©ë¡</h2>

        <div id="movie-list" class="movie-list">
            <!-- ì˜í™” ëª©ë¡ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
    </div>

    <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
<button id="search-button" onclick="searchMoviesAndTVShows()">ê²€ìƒ‰</button>

<!-- ëª¨ë‹¬ -->
<div id="search-modal" style="display:none;">
    <div class="modal-content">
        <!-- ë‹«ê¸° ë²„íŠ¼ -->
        <span onclick="closeModal()" style="cursor: pointer; float: right;">X</span>

        <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ ë²„íŠ¼ -->
        <div id="category-buttons">
            <button onclick="showCategory('all')">ì „ì²´</button>
            <button onclick="showCategory('movie')">ì˜í™”</button>
            <button onclick="showCategory('tv')">ë“œë¼ë§ˆ</button>
        </div>

        <!-- ê²€ìƒ‰ ê²°ê³¼ -->
        <div id="results"></div>
    </div>
</div>
</body>
</html>
