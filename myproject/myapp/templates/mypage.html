<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë“œë¼ë§ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #333;
            color: white;
            padding: 10px;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-links {
            display: flex;
            gap: 20px;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 10px;
        }
        .search-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .search-box input {
            padding: 5px;
            width: 200px;
        }
        .search-box button {
            padding: 5px;
        }
        .container {
            padding: 140px 20px 20px; /* Header ë†’ì´ì™€ ë¹„ë””ì˜¤ ë†’ì´ë§Œí¼ ì—¬ë°±ì„ ë‘¡ë‹ˆë‹¤ */
        }
        .tv-show-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .tv-show-item {
            width: 200px;
            text-align: center;
        }
        .tv-show-item img {
            width: 100%;
            height: auto;
        }
        #results {
            margin-top: 20px;
        }
        .login-signup {
            margin-left: auto;
        }

        /* ì˜í™” í¬ìŠ¤í„° ì»¨í…Œì´ë„ˆ */
        .tv-show-poster-container {
            width: 100%;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            margin-bottom: 20px;
            overflow: hidden; /* ì˜ë¦° ë¶€ë¶„ì„ ìˆ¨ê¹ë‹ˆë‹¤ */
        }

        .tv-show-poster-container img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ ìë¥´ê¸° */
        }

        /* ëª¨ë‹¬ ì°½ ìŠ¤íƒ€ì¼ */
        #search-modal {
            display: none; /* ì²˜ìŒì—ëŠ” ë³´ì´ì§€ ì•Šë„ë¡ ì„¤ì • */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            text-align: center;
            max-height: 80vh; /* í™”ë©´ì˜ 80%ê¹Œì§€ ë†’ì´ë¥¼ ì œí•œ */
            overflow-y: auto; /* ë‚´ìš©ì´ ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
        }

        #results {
            max-height: 70vh; /* ê²°ê³¼ ì˜ì—­ì˜ ìµœëŒ€ ë†’ì´ë¥¼ ì œí•œ */
            overflow-y: auto; /* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì • */
        }
    </style>
    <script>
        const apiKey = 'e5abc725f37f23d195a7177e0f160729'; // ì—¬ê¸°ì— API í‚¤ë¥¼ ë„£ìœ¼ì„¸ìš”

        async function fetchPopularTVShows() {
            let tvShowList = document.getElementById('tv-show-list');
            tvShowList.innerHTML = ''; // ê¸°ì¡´ ì½˜í…ì¸  ë¹„ìš°ê¸°
        
            const totalPages = 5; // 5í˜ì´ì§€ê¹Œì§€ ê°€ì ¸ì˜¤ê¸°
            let tvShows = new Map(); // ì¤‘ë³µ ì œê±°ë¥¼ ìœ„í•œ Map (key: id)
        
            for (let page = 1; page <= totalPages; page++) {
                try {
                    const response = await fetch(`https://api.themoviedb.org/3/tv/popular?api_key=${apiKey}&language=ko-KR&page=${page}`);
                    if (!response.ok) {
                        throw new Error('ì¸ê¸° ë“œë¼ë§ˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
        
                    const data = await response.json();
                    if (data.results) {
                        // 'original_language'ê°€ 'ko'ì¸ ë“œë¼ë§ˆë§Œ í•„í„°ë§
                        data.results.forEach(show => {
                            if (show.original_language === 'ko' && !tvShows.has(show.id)) {
                                tvShows.set(show.id, show); // ì¤‘ë³µ ì œê±°í•˜ë©´ì„œ ì¶”ê°€
                            }
                        });
        
                        // 6ê°œë§Œ í™”ë©´ì— í‘œì‹œ
                        if (tvShows.size >= 6) {
                            displayTVShows(Array.from(tvShows.values()).slice(0, 6));
                            return; // ì´ë¯¸ 6ê°œë¥¼ ë¶ˆëŸ¬ì™”ìœ¼ë©´ ì¢…ë£Œ
                        }
                    }
                } catch (error) {
                    console.error(error);
                    tvShowList.innerHTML = `<p>${error.message}</p>`;
                    return;
                }
            }
        
            // í˜¹ì‹œ 5í˜ì´ì§€ë¥¼ ë‹¤ ë¶ˆëŸ¬ì™€ë„ 6ê°œê°€ ì•ˆ ì°¼ì„ ê²½ìš°
            displayTVShows(Array.from(tvShows.values()).slice(0, 6));
        }
        
        // ë“œë¼ë§ˆë¥¼ í™”ë©´ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function displayTVShows(shows) {
            let tvShowList = document.getElementById('tv-show-list');
            tvShowList.innerHTML = ''; // ê¸°ì¡´ ì½˜í…ì¸  ë¹„ìš°ê¸°
            
            shows.forEach(show => {
                const showElement = document.createElement('div');
                showElement.classList.add('tv-show-item');
                showElement.innerHTML = `
                    <img src="https://image.tmdb.org/t/p/w200${show.poster_path}" alt="${show.name}">
                    <h3>${show.name}</h3>
                    <p>${show.first_air_date}</p>
                `;
                tvShowList.appendChild(showElement);
            });
        
            // í¬ìŠ¤í„° ë³€ê²½ ì‹œì‘
            showPoster(shows, 0); // ì²« ë²ˆì§¸ í¬ìŠ¤í„°ë¶€í„° ì‹œì‘
        }
        
        // í¬ìŠ¤í„° í‘œì‹œí•˜ê¸°
        function showPoster(shows, index) {
            const posterContainer = document.querySelector('.tv-show-poster-container');
            posterContainer.innerHTML = ''; // ì´ì „ í¬ìŠ¤í„° ì‚­ì œ
        
            const show = shows[index];
            const posterElement = document.createElement('img');
            posterElement.src = `https://image.tmdb.org/t/p/w500${show.poster_path}`;
            posterElement.alt = show.name;
            posterContainer.appendChild(posterElement);
        
            // ì¼ì • ì‹œê°„ í›„ ë‹¤ìŒ ë“œë¼ë§ˆ í¬ìŠ¤í„°ë¡œ ë³€ê²½
            setTimeout(() => {
                const nextIndex = (index + 1) % shows.length;
                showPoster(shows, nextIndex);
            }, 5000); // 5ì´ˆë§ˆë‹¤ í¬ìŠ¤í„° ë³€ê²½
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ê¸° ë“œë¼ë§ˆ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        window.onload = function() {
            fetchPopularTVShows();
        };

        // ì˜í™” ê²€ìƒ‰í•˜ê¸°
        let movieData = null;
        let tvData = null;

        // ì˜í™” ë° TV ë“œë¼ë§ˆ ê²€ìƒ‰í•˜ê¸°
        function searchMoviesAndTVShows() {
            const query = document.getElementById("search-input").value;
            if (!query) {
                alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
                return;
            }

            const movieSearchUrl = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&language=ko-KR&query=${encodeURIComponent(query)}`;
            const tvSearchUrl = `https://api.themoviedb.org/3/search/tv?api_key=${apiKey}&language=ko-KR&query=${encodeURIComponent(query)}`;

            // ë‘ ê°œì˜ API ìš”ì²­ì„ ë™ì‹œì— ì‹¤í–‰
            Promise.all([
                fetch(movieSearchUrl).then(response => response.json()),
                fetch(tvSearchUrl).then(response => response.json())
            ])
            .then(([movieDataResponse, tvDataResponse]) => {
                movieData = movieDataResponse.results; // ì˜í™” ë°ì´í„° ì €ì¥
                tvData = tvDataResponse.results; // ë“œë¼ë§ˆ ë°ì´í„° ì €ì¥

                // ëª¨ë‹¬ ì—´ê¸°
                openModal();

                // ì²˜ìŒ ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ì „ì²´ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤Œ
                showCategory('all');
            })
            .catch(error => {
                console.error(error);
                document.getElementById("results").innerHTML = `<p>ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>`;
            });
        }

        // ì „ì²´/ì˜í™”/ë“œë¼ë§ˆ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê²°ê³¼ ë³´ì—¬ì£¼ê¸°
        function showCategory(category) {
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = ""; // ê¸°ì¡´ ê²€ìƒ‰ ê²°ê³¼ ì´ˆê¸°í™”

            let results = [];

            if (category === 'all' || category === 'movie') {
                if (movieData.length > 0) {
                    results.push(`<h2>ğŸ¬ ì˜í™”</h2>`);
                    movieData.forEach(movie => {
                        results.push(`
                            <div>
                                <h3>${movie.title} (${movie.release_date ? movie.release_date.substring(0, 4) : "ë¯¸ì •"})</h3>
                                <img src="https://image.tmdb.org/t/p/w200${movie.poster_path}" alt="${movie.title}">
                                <p>${movie.overview || "ì¤„ê±°ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤."}</p>
                            </div>
                        `);
                    });
                }
            }

            if (category === 'all' || category === 'tv') {
                if (tvData.length > 0) {
                    results.push(`<h2>ğŸ“º TV ë“œë¼ë§ˆ</h2>`);
                    tvData.forEach(show => {
                        results.push(`
                            <div>
                                <h3>${show.name} (${show.first_air_date ? show.first_air_date.substring(0, 4) : "ë¯¸ì •"})</h3>
                                <img src="https://image.tmdb.org/t/p/w200${show.poster_path}" alt="${show.name}">
                                <p>${show.overview || "ì¤„ê±°ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤."}</p>
                            </div>
                        `);
                    });
                }
            }

            if (results.length === 0) {
                resultsDiv.innerHTML = "<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
            } else {
                resultsDiv.innerHTML = results.join(""); // ê²°ê³¼ ì¶œë ¥
            }
        }

        // ëª¨ë‹¬ ì—´ê¸°
        function openModal() {
            document.getElementById("search-modal").style.display = "flex";
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById("search-modal").style.display = "none";
        }

        
    </script>
</head>
<body>
    <header>
        <div class="nav-links">
            <a href="{% url 'home' %}">HOME</a>
            <a href="{% url 'movie' %}">MOVIE</a>
            <a href="{% url 'drama' %}">DRAMA</a>
            <a href="#">CHALLENGE</a>
            <a href="#">MYPAGE</a>
        </div>

        <div class="search-box">
            <input type="text" id="search-input" placeholder="ì˜í™”/ë“œë¼ë§ˆ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            <button onclick="searchMoviesAndTVShows()">ê²€ìƒ‰</button>
        </div>

        <div class="login-signup">
            <a href="#">ë¡œê·¸ì¸</a> | <a href="#">íšŒì›ê°€ì…</a>
        </div>
    </header>

    <div class="container">
        <h1>ë“œë¼ë§ˆ í™”ë©´</h1>


        <!-- ì˜í™” í¬ìŠ¤í„°ë¥¼ í‘œì‹œí•  ì»¨í…Œì´ë„ˆ -->
        <div class="tv-show-poster-container">
            <!-- í¬ìŠ¤í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>

        <h2> ì¸ê¸° ë“œë¼ë§ˆ ëª©ë¡ </h2>

        <div id="tv-show-list" class="tv-show-list">
            <!-- ì˜í™” ëª©ë¡ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
    </div>

    <!-- ëª¨ë‹¬ -->
<div id="search-modal" style="display:none;">
    <div class="modal-content">
        <!-- ë‹«ê¸° ë²„íŠ¼ -->
        <span onclick="closeModal()" style="cursor: pointer; float: right;">X</span>

        <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ ë²„íŠ¼ -->
        <div id="category-buttons">
            <button onclick="showCategory('all')">ì „ì²´</button>
            <button onclick="showCategory('movie')">ì˜í™”</button>
            <button onclick="showCategory('tv')">ë“œë¼ë§ˆ</button>
        </div>

        <!-- ê²€ìƒ‰ ê²°ê³¼ -->
        <div id="results"></div>
    </div>
</div>
</body>
</html>
